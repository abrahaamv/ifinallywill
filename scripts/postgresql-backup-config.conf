# PostgreSQL WAL Archiving Configuration
#
# Add these settings to postgresql.conf to enable WAL archiving for backups
#
# Location (Ubuntu/Debian): /etc/postgresql/16/main/postgresql.conf
# Location (Docker): Add to docker-compose.yml as command options
#
# After adding these settings, restart PostgreSQL:
#   sudo systemctl restart postgresql
#

# =============================================================================
# WAL ARCHIVING CONFIGURATION
# =============================================================================

# Enable WAL archiving (required for point-in-time recovery)
archive_mode = on

# Archive command - calls our custom archive script
# %p = full path to WAL file
# %f = WAL filename only
archive_command = '/home/abrahaam/Documents/GitHub/platform/scripts/archive-wal.sh %p %f'

# Archive timeout - force WAL switch every 5 minutes even if not full
# This ensures recent data is archived promptly
archive_timeout = 300

# =============================================================================
# WAL CONFIGURATION (for backup compatibility)
# =============================================================================

# WAL level must be 'replica' or 'logical' for archiving
# Current value: replica (already correct)
wal_level = replica

# Number of WAL segment files to keep (each 16MB)
# Keep at least 32 segments (~512MB) for backup windows
min_wal_size = 512MB
max_wal_size = 2GB

# =============================================================================
# ADDITIONAL RECOMMENDED SETTINGS
# =============================================================================

# Enable checksums for data integrity (requires initdb --data-checksums)
# Check current status: SHOW data_checksums;
# data_checksums = on  # Requires cluster re-initialization

# Logging for backup operations
log_checkpoints = on
log_connections = on
log_disconnections = on

# Connection settings (ensure backup tools can connect)
max_connections = 100

# =============================================================================
# DOCKER COMPOSE CONFIGURATION
# =============================================================================
#
# For Docker deployments, add these as command options:
#
# services:
#   postgres:
#     image: postgres:16
#     command:
#       - postgres
#       - -c
#       - archive_mode=on
#       - -c
#       - archive_command=/scripts/archive-wal.sh %p %f
#       - -c
#       - archive_timeout=300
#     volumes:
#       - ./scripts:/scripts
#       - /var/backups/postgresql/wal_archive:/var/backups/postgresql/wal_archive
#
# =============================================================================
